<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pengolahan Nilai Ijazah</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">

    <?!= include('style'); ?>
  </head>
  <body>

    <div id="loader" style="display: none;">
      <div class="spinner"></div>
    </div>

    <div class="container" id="auth-container" style="display: none;">

      <div class="app-header">
        <h1>Nilai Ijazah</h1>
        <p>Aplikasi Pengolahan Nilai Sekolah</p>
      </div>

      <div id="halaman-login" class="page">
        <form id="login-form">
          <div class="form-group">
            <input type="email" id="login-email" placeholder="Email Admin Sekolah" name="email" autocomplete="email">
          </div>
          <div class="form-group form-group-password">
            <input type="password" id="login-password" placeholder="Password" name="password" autocomplete="current-password">
            <span id="toggle-login-password" class="toggle-password-icon fas fa-eye"></span>
          </div>
        </form>
        <button id="btn-login"><i class="fas fa-sign-in-alt"></i>Masuk</button>
        <p id="login-error" class="message error"></p>
        <a id="link-ke-registrasi" class="nav-link">Belum punya akun? Daftar di sini</a>
      </div>

      <div id="halaman-registrasi" class="page" style="display: none;">
        <form id="reg-form">
          <div class="form-group">
            <input type="text" id="reg-nama-sekolah" placeholder="Nama Sekolah">
          </div>
          <div class="form-group">
            <select id="reg-jenjang">
              <option value="">-- Pilih Jenjang --</option>
              <option value="SD/MI">SD/MI</option>
              <option value="SMP/MTS">SMP/MTS</option>
              <option value="SMA/MA">SMA/MA</option>
            </select>
          </div>
          <div class="form-group">
            <input type="email" id="reg-email" placeholder="Email Admin">
          </div>
          <div class="form-group form-group-password">
            <input type="password" id="reg-password" placeholder="Buat Password" name="password" autocomplete="new-password">
            <span id="toggle-reg-password" class="toggle-password-icon fas fa-eye"></span>
          </div>
        </form>
        <button id="btn-registrasi"><i class="fas fa-user-plus"></i>Daftar</button>
        <p id="reg-message" class="message"></p>
        <a id="link-ke-login" class="nav-link">Sudah punya akun? Login</a>
      </div>

    </div>

<div class="container" id="halaman-utama" style="display: none;">
      <div class="page">
        <div class="page-top-nav">
          <button id="btn-logout"><i class="fas fa-sign-out-alt"></i>Logout</button>
        </div>

        <h2 id="salam-sekolah">Selamat Datang, Admin</h2>
        <p>Ini adalah dashboard utama. Silakan pilih menu di bawah ini:</p>

        <div class="dashboard-menu-grid">
          <button class="dashboard-card" id="btn-buka-data-sekolah">
            <i class="fas fa-school"></i>
            <span>Kelola Data Sekolah</span>
          </button>
          <button class="dashboard-card" id="btn-buka-siswa">
            <i class="fas fa-users"></i>
            <span>Kelola Data Siswa</span>
          </button>
          <button class="dashboard-card" id="btn-buka-mapel">
            <i class="fas fa-book-open"></i>
            <span>Kelola Mata Pelajaran</span>
          </button>
          <button class="dashboard-card" id="btn-buka-bobot">
            <i class="fas fa-balance-scale"></i>
            <span>Kelola Bobot Nilai</span>
          </button>
          <button class="dashboard-card" id="btn-buka-kelas">
            <i class="fas fa-chalkboard-teacher"></i>
            <span>Kelola Kelas</span>
          </button>
        </div>
      </div>
    </div>

    <div class="container" id="halaman-data-sekolah" style="display: none;">
      <div class="page">
        <div class="page-top-nav">
          <button type="button" id="btn-kembali-ke-dashboard-2"><i class="fas fa-arrow-circle-left"></i>Kembali ke Dasbor</button>
        </div>

        <div class="page-header">
          <h2>Kelola Data Sekolah</h2>
        </div>

        <p>Lengkapi data identitas sekolah Anda. Data ini akan digunakan pada dokumen dan laporan.</p>

        <form id="form-data-sekolah">

          <h3 class="form-section-header">Identitas Utama</h3>
          <div class="form-group">
            <label for="data-nama-sekolah">Nama Sekolah</label>
            <input type="text" id="data-nama-sekolah" disabled>
          </div>
          <div class="form-group">
            <label for="data-jenjang-pilihan">Jenjang Sekolah (Wajib)</label>
            <select id="data-jenjang-pilihan"></select>
          </div>
          <div class="form-group">
            <label for="data-npsn">NPSN (Wajib)</label>
            <input type="text" id="data-npsn" placeholder="Masukkan NPSN">
          </div>
          <div class="form-group" id="grup-nsm">
            <label for="data-nsm">NSM</label>
            <input type="text" id="data-nsm" placeholder="Masukkan NSM (jika ada)">
          </div>

          <h3 class="form-section-header">Alamat</h3>
          <div class="form-group">
            <label for="data-alamat">Alamat Sekolah (Wajib)</label>
            <textarea id="data-alamat" rows="3" placeholder="Masukkan alamat lengkap sekolah"></textarea>
          </div>
          <div class="form-group">
            <label for="data-provinsi">Provinsi</label>
            <input type="text" id="data-provinsi" placeholder="Misal: Jawa Barat">
          </div>
          <div class="form-group-inline">
            <div class="form-group" style="flex-grow: 1;">
              <label for="data-kabkot">Kabupaten/Kota</label>
              <input type="text" id="data-kabkot" placeholder="Misal: Kota Bandung">
            </div>
            <div class="form-group" style="width: 150px;">
              <label>&nbsp;</label>
              <select id="data-pilihan-kabkot">
                <option value="Kabupaten">Kabupaten</option>
                <option value="Kota">Kota</option>
              </select>
            </div>
          </div>
          <div class="form-group">
            <label for="data-kecamatan">Kecamatan</label>
            <input type="text" id="data-kecamatan" placeholder="Misal: Coblong">
          </div>
          <div class="form-group-inline">
            <div class="form-group" style="flex-grow: 1;">
              <label for="data-keldes">Kelurahan/Desa</label>
              <input type="text" id="data-keldes" placeholder="Misal: Dago">
            </div>
            <div class="form-group" style="width: 150px;">
              <label>&nbsp;</label>
              <select id="data-pilihan-keldes">
                <option value="Kelurahan">Kelurahan</option>
                <option value="Desa">Desa</option>
              </select>
            </div>
          </div>
          <div class="form-group">
            <label for="data-kodepos">Kode Pos</label>
            <input type="text" id="data-kodepos" placeholder="Misal: 40135">
          </div>

          <h3 class="form-section-header">Kontak & Legalitas</h3>
          <div class="form-group">
            <label for="data-telepon">Nomor Telepon</label>
            <input type="text" id="data-telepon" placeholder="Misal: (022) 2501234">
          </div>
          <div class="form-group">
            <label for="data-email">Email</label>
            <input type="text" id="data-email" placeholder="Misal: info@sekolah.sch.id">
          </div>
          <div class="form-group">
            <label for="data-website">Website</label>
            <input type="text" id="data-website" placeholder="Misal: https://sekolah.sch.id">
          </div>
          <div class="form-group">
            <label for="data-kepsek">Nama Kepala Sekolah (Wajib)</label>
            <input type="text" id="data-kepsek" placeholder="Masukkan nama lengkap">
          </div>
          <div class="form-group">
            <label for="data-nip-kepsek">NIP Kepala Sekolah</label>
            <input type="text" id="data-nip-kepsek" placeholder="Masukkan NIP (jika ada)">
          </div>

          <p id="data-sekolah-message" class="message" style="display: none;"></p>

          <hr>
          <div class="form-actions">
              <button type="submit" id="btn-simpan-data-sekolah"><i class="fas fa-save"></i>Simpan Perubahan</button>
          </div>
        </form>
      </div>
    </div>

    <div class="container" id="halaman-bobot" style="display: none;">
      <div class="page">
        <div class="page-top-nav">
          <button type="button" id="btn-kembali-ke-dashboard-3"><i class="fas fa-arrow-circle-left"></i>Kembali ke Dasbor</button>
        </div>

        <div class="page-header">
          <h2>Kelola Bobot Nilai Ijazah</h2>
        </div>

        <p>Atur persentase bobot untuk nilai rapor dan nilai ujian. Total keduanya harus 100%. Bobot default adalah 60% Rapor dan 40% Ujian.</p>

        <form id="form-bobot">

          <div class="form-group">
            <label for="bobot-rapor">Bobot Nilai Rapor (%)</label>
            <input type="number" id="bobot-rapor" min="0" max="100" placeholder="Contoh: 60">
          </div>

          <div class="form-group">
            <label for="bobot-ujian">Bobot Nilai Ujian (%)</label>
            <input type="number" id="bobot-ujian" min="0" max="100" placeholder="Contoh: 40">
          </div>

          <p id="bobot-message" class="message" style="display: none;"></p>

          <hr>
          <div class="form-actions">
              <button type="submit" id="btn-simpan-bobot"><i class="fas fa-save"></i>Simpan Perubahan</button>
          </div>
        </form>
      </div>
    </div>

    <div class="container" id="halaman-kelas" style="display: none;">
      <div class="page">
        <div class="page-top-nav">
          <button type="button" id="btn-kembali-ke-dashboard-4"><i class="fas fa-arrow-circle-left"></i>Kembali ke Dasbor</button>
        </div>

        <div class="page-header">
          <h2>Kelola Kelas</h2>
        </div>

        <p>Masukkan nama-nama kelas yang ada di sekolah Anda. Klik tombol (+) untuk menambah baris baru.</p>

        <form id="form-kelas">

          <div id="kelas-list-container">
            <p>Memuat data kelas...</p>
          </div>

          <p id="kelas-message" class="message" style="display: none;"></p>

          <hr>
          <div class="form-actions">
              <button type="submit" id="btn-simpan-kelas"><i class="fas fa-save"></i>Simpan Perubahan</button>
          </div>
        </form>
      </div>
    </div>


    <div class="container" id="halaman-siswa" style="display: none;">
      <div class="page">
        <div class="page-top-nav">
            <button id="btn-kembali-ke-dashboard-5"><i class="fas fa-arrow-circle-left"></i>Kembali ke Dasbor</button>
        </div>

        <div class="page-header">
          <h2>Kelola Data Siswa</h2>
          <div class="header-buttons">
            <button id="btn-tambah-siswa-baru"><i class="fas fa-plus"></i>Tambah Siswa</button>
            <button id="btn-import-siswa"><i class="fas fa-upload"></i>Import Siswa</button>
            <button id="btn-hapus-semua-siswa"><i class="fas fa-trash-alt"></i>Hapus Semua Siswa</button>
          </div>
        </div>

        <p>Kelola data siswa di sekolah Anda. Data ini akan digunakan untuk input nilai.</p>

        <div class="siswa-table-container" id="siswa-table-container">
          <p>Memuat data siswa...</p>
        </div>
      </div>
    </div>

    <div class="container" id="halaman-mapel" style="display: none;">
      <div class="page">
        <div class="page-top-nav">
          <button id="btn-kembali-ke-dashboard"><i class="fas fa-arrow-circle-left"></i>Kembali ke Dasbor</button>
        </div>

        <div class="page-header">
          <h2>Kelola Mapel</h2>
          <div class="header-buttons">
            <button id="btn-tambah-mapel-baru"><i class="fas fa-plus"></i>Tambah Mapel</button>
            <button id="btn-ambil-default"><i class="fas fa-download"></i>Ambil Mapel Default</button>
            <button id="btn-hapus-semua"><i class="fas fa-trash-alt"></i>Hapus Semua Mapel</button>
            </div>
        </div>

        <p>Kelola mata pelajaran yang akan digunakan di sekolah Anda.</p>

        <div class="mapel-table-container" id="mapel-table-container">
          <p>Memuat data mapel...</p>
        </div>
      </div>
    </div>

    <div id="siswa-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2 id="modal-siswa-title">Tambah Siswa Baru</h2>
          <span class="close-button" id="btn-tutup-modal-siswa">&times;</span>
        </div>
        <div class="modal-body">
          <input type="hidden" id="modal-siswa-mode" value="add">
          <input type="hidden" id="modal-siswa-id" value="">

          <div class="form-group">
            <label for="modal-siswa-nama">Nama Lengkap Siswa (Wajib)</label>
            <input type="text" id="modal-siswa-nama" placeholder="Masukkan nama lengkap">
          </div>
          <div class="form-group">
            <label for="modal-siswa-nisn">NISN Siswa (Wajib)</label>
            <input type="text" id="modal-siswa-nisn" placeholder="Masukkan NISN">
          </div>
          <div class="form-group">
            <label for="modal-siswa-nis-lokal">NIS Lokal (Opsional)</label>
            <input type="text" id="modal-siswa-nis-lokal" placeholder="Misal: 240001">
            <small class="helper-text">Format: 2 digit tahun masuk, 4 digit no. urut</small>
          </div>
          <div class="form-group">
            <label for="modal-siswa-jk">Jenis Kelamin (Wajib)</label>
            <select id="modal-siswa-jk">
              <option value="">-- Pilih Jenis Kelamin --</option>
              <option value="L">Laki-laki</option>
              <option value="P">Perempuan</option>
            </select>
          </div>
          <div class="form-group">
            <label for="modal-siswa-tempat-lahir">Tempat Lahir (Opsional)</label>
            <input type="text" id="modal-siswa-tempat-lahir" placeholder="Misal: Jakarta">
          </div>
          <div class="form-group">
            <label for="modal-siswa-tgl-lahir">Tanggal Lahir (Opsional)</label>
            <input type="date" id="modal-siswa-tgl-lahir">
          </div>
          <div class="form-group">
            <label for="modal-siswa-kelas">Kelas (Wajib)</label>
            <select id="modal-siswa-kelas">
              <option value="">-- Memuat kelas... --</option>
            </select>
          </div>

          <p id="modal-siswa-error" class="message error"></p>
        </div>
        <div class="modal-footer">
          <button id="btn-batal-modal-siswa"><i class="fas fa-times"></i>Batal</button>
          <button id="btn-simpan-siswa"><i class="fas fa-save"></i>Simpan</button>
        </div>
      </div>
    </div>
    <div id="mapel-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2 id="modal-title">Tambah Mapel Baru</h2>
          <span class="close-button" id="btn-tutup-modal">&times;</span>
        </div>
        <div class="modal-body">
          <input type="hidden" id="modal-mapel-mode" value="add">

          <div class="form-group">
            <label for="modal-mapel-id">Kode Mapel (Unik)</label>
            <input type="text" id="modal-mapel-id" placeholder="Contoh: MTK, BIN, FIS">
          </div>
          <div class="form-group">
            <label for="modal-mapel-nama">Nama Mata Pelajaran</label>
            <input type="text" id="modal-mapel-nama" placeholder="Contoh: Matematika">
          </div>
          <p id="modal-mapel-error" class="message error"></p>
        </div>
        <div class="modal-footer">
          <button id="btn-batal-modal"><i class="fas fa-times"></i>Batal</button>
          <button id="btn-simpan-mapel"><i class="fas fa-save"></i>Simpan</button>
        </div>
      </div>
    </div>

    <div id="confirmation-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2 id="confirm-modal-title">Konfirmasi</h2>
          <span class="close-button" id="btn-confirm-close">&times;</span>
        </div>
        <div class="modal-body" id="confirm-modal-body">
          </div>
        <div class="modal-footer">
          <button id="btn-confirm-cancel"><i class="fas fa-times"></i>Batal</button>
          <button id="btn-confirm-ok"><i class="fas fa-check"></i>OK</button>
        </div>
      </div>
    </div>

    <div id="info-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2 id="info-modal-title">Informasi</h2>
          <span class="close-button" id="btn-info-close">&times;</span>
        </div>
        <div class="modal-body" id="info-modal-body">
          </div>
        <div class="modal-footer">
          <button id="btn-info-ok"><i class="fas fa-check"></i>OK</button>
        </div>
      </div>
    </div>

    <div id="import-siswa-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2 id="modal-import-siswa-title">Import Data Siswa</h2>
          <span class="close-button" id="btn-tutup-modal-import-siswa">&times;</span>
        </div>
        <div class="modal-body">
          <p>Import data siswa menggunakan file Excel. Ikuti langkah-langkah di bawah ini:</p>
          
          <div class="import-step-box">
            <div class="import-step-number">1</div>
            <div class="import-step-content">
              <h4 class="import-step-header">Unduh Template</h4>
              <p>Dapatkan template Excel, isi data siswa, dan pastikan semua kolom wajib terisi.</p>
              <button id="btn-download-template-siswa" class="btn-aksi"><i class="fas fa-file-excel"></i>Unduh Template (.xlsx)</button>
              <p id="template-message" class="message" style="display: none;"></p>
            </div>
          </div>

          <div class="import-step-box">
            <div class="import-step-number">2</div>
            <div class="import-step-content">
              <h4 class="import-step-header">Unggah File Excel</h4>
              <p>Pilih file Excel (`.xlsx` atau `.xls`) yang sudah Anda isi.</p>
              
              <label for="file-upload-siswa" class="file-upload-zone" id="file-upload-zone">
                <input type="file" id="file-upload-siswa" accept=".xlsx, .xls, application/vnd.ms-excel, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet">
                
                <i class="fas fa-cloud-upload-alt"></i>
                <span id="file-upload-text">Klik untuk memilih file atau seret & letakkan di sini.</span>
              </label>
            </div>
          </div>

          <div id="import-siswa-results" style="display: none;">
            </div>
          
        </div>
        <div class="modal-footer">
          <button id="btn-batal-modal-import-siswa"><i class="fas fa-times"></i>Tutup</button>
          <button id="btn-proses-import-siswa" disabled><i class="fas fa-cogs"></i>Proses Import</button>
        </div>
      </div>
    </div>

    <?!= include('client'); ?>
  </body>
</html>
